<html>
<div style="position: relative; left: 1150px; top: 0px;">
<img src="data/logo.png" align="center">
</div> 
<style>
body {
  background-image: url(data/background.jpg);
  background-size: cover;
}
</style>
<font color=#FFFFFF face="Verdana">  
<h1>REX Virtual Machine Documentation</h1>
<h2>Executable Format</h2>
REX uses it's own executable format for loading programs, the structure for a REX executable program is thus defined <br>
in src/include/r3x_format.h:5<br>
<textarea name="code" class="c#" cols="60" rows="10">
typedef struct r3x_header {
	uint32_t header_id;
	uint32_t program_header;
	uint16_t minor;
	uint16_t major;
	uint32_t r3x_init;
	uint32_t r3x_text_size;
	uint32_t r3x_data;
	uint32_t r3x_data_size;
	uint32_t r3x_bss;
	uint32_t r3x_bss_size;
	uint32_t stack_size;
	uint32_t total_size;
	uint32_t nameaddr;
	uint32_t pubaddr;
} r3x_header_t;
</textarea>
<h3>Description</h3>
<pre>
<b><i>uint32_t header_id</i></b>: A magic number used for identification. 0xBA5EBA11 as defined by the REX standard.<br>
<b><i>uint32_t program_header</i></b>: Pointer to the first byte in the executable.<br>
<b><i>uint16_t minor</i></b>: Minor version of the program<br>
<b><i>uint16_t major</i></b>: Major version of the program<br>
<b><i>uint32_t r3x_init</i></b>: Pointer to the program's start function.<br>
<b><i>uint32_t r3x_text_size</i></b>: Size of the .text section.<br>
<b><i>uint32_t r3x_data</i></b>: Pointer to the program's data function.<br>
<b><i>uint32_t r3x_data_size</i></b>: Size of the data section<br>
<b><i>uint32_t r3x_symbols</i></b>: Pointer to start of symbol table<br>
<b><i>uint32_t r3x_symbolsize</i></b>: Size of symbol table<br>
<b><i>uint32_t r3x_bss</i></b>: Pointer to the program's BSS section.<br>
<b><i>uint32_t r3x_bss_size</i></b>: Size of the bss section<br>
<b><i>uint32_t stack_size</i></b>: Size of Stack (depends upon how the implementation treats it. Official implementation does not use this value)<br>
<b><i>uint32_t nameaddr/pubaddr</i></b>: Pointer to all null-terminated string containing name of executable and pulibsher.<br>
</pre>
<h3>Writing a program</h3>
<pre>
Using LIBR3X, one can define their own sections, like this <br>
<pre>DECLARE_SECTION MYSECTION ; </pre>
By default there are 2 sections: DATA and BSS (for program data and uninitialised values respectively) <br>
Then under the _data section, it must be stored like: <br>
<pre>.data {
	STORE_SECTION_MYSECTION
}
</pre>
To put data into a section use <br>
<pre>
.MYSECTION {
	mydata: db '000', 0
}
If inside a macro use brackets with a slash (\{ and \})
</pre>
The template defined by the standard is thus, <br>
<textarea name="code" class="c#" cols="60" rows="10">
include 'libR3X/libR3X.pkg'
.text {
	; main is mandatory
	; Code here
	function main
	; Main code
	endfunction main
	
	function someotherfunction
	; Other code
	endfunction someotherfunction
}
.data {
	data here
}
.bss {
	bss here
}
; Don't forget to put an 'end' directive at the end of your main module!
end 
</textarea>
For compiling the program please use FASM (flat assembler), get it here: http://flatassembler.net, or under the /fasm directory in the<br>
repository. (Beware, it's not frequently updated)<br>
<h2>REX symbol table</h2>
The R3X Symbol table, is a special section in the executable, prefixed by ".##$symbols", it contains the program's function names, their start<br>
addresses, and size infromation. <br>
Each symbol looks like this in the symbol table:<br>
<pre>
uint32_t nameaddr
uint32_t startIP
uint32_t endIP
</pre>
The sections must be contiguous and page-aligned (4096 = per page) aligned. libR3X does this through filling up zeroes and making addresses page aligned..<br>
Note that the symbol table is only <b>specific</b> to R3X executables, the R3X Dynamic linking system uses export tables, which are<br>
a more efficient and less space consuming way, albeit less descriptive.<br>
The R3X debugger command, "readsym" can be used to parse symbols, also the "readrex" utility can also be used to parse symbols<br>
</font>
</html>
